"use strict";$(function(){function e(){function e(){var e={center:w,zoom:14,minZoom:3,maxZoom:18,disableDefaultUI:!0};f=new google.maps.Map(document.getElementById("map-canvas"),e),m=new google.maps.InfoWindow({pixelOffset:new google.maps.Size(-23,-10)}),y=new google.maps.StyledMapType(x,{name:"Styled Map"}),f.mapTypes.set("map_style",y),f.setMapTypeId("map_style")}function n(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){w={lat:e.coords.latitude,lng:e.coords.longitude},f.setCenter(w),a(w)},function(){t(!0,m,f.getCenter())}):t(!1,m,f.getCenter())}function t(e,n,t){a(w)}function a(e){v.nearByPlaces([]);var n=new google.maps.places.PlacesService(f);n.nearbySearch({location:e,radius:v.radius(),types:k},o)}function o(e,n,t){{var a=new google.maps.LatLngBounds;document.getElementById("places")}if(n===google.maps.places.PlacesServiceStatus.OK){for(var o,i=0;o=e[i];i++)"political"!=o.types[o.types.length-1]&&(v.nearByPlaces.push(o),a.extend(o.geometry.location));r(v.nearByPlaces()),f.fitBounds(a),k=[]}}function i(){v.places([]);var e=document.getElementById("search-input"),n=new google.maps.places.SearchBox(e);f.addListener("bounds_changed",function(){n.setBounds(f.getBounds()),w=f.getCenter()}),n.addListener("places_changed",function(){var e=n.getPlaces();v.places(e),0!=v.places().length&&(1==v.places().length?(a(v.places()[0].geometry.location),v.nearByPlaces().push(e[0])):r(v.places()))}),k=[]}function r(e){document.getElementById("search-input").value="",v.keyword(""),v.markers().forEach(function(e){e.setMap(null)}),v.markers([]),h=new google.maps.LatLngBounds,e.forEach(function(e){var n={url:e.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)},t=new google.maps.Marker({map:f,icon:n,title:e.name,animation:google.maps.Animation.DROP,position:e.geometry.location});t.addListener("click",function(){v.markers().forEach(function(e){e.setAnimation(null)}),t.setAnimation(null!==t.getAnimation()?null:google.maps.Animation.BOUNCE)}),v.markers().push(t),google.maps.event.addListener(t,"click",function(){s(e,t)}),e.geometry.viewport?h.union(e.geometry.viewport):h.extend(e.geometry.location)}),f.fitBounds(h)}function s(e,n){var t=new google.maps.places.PlacesService(f);t.getDetails({placeId:e.place_id},function(e,t){d(e),t===google.maps.places.PlacesServiceStatus.OK&&(m.setContent('<div id="infoWindow" style="width: 200px; display: none;"><strong>'+e.name+'</strong><hr><span">'+e.formatted_address+'</span><br><span style="color: #275076; font-size: 12px; font-style: italic">'+l(e)+'</span><br><br><div id="wiki" style="white-space: normal;"><span></span></div><br>'+c(e)+"<br><span>"+p(e)+'</span><br><div class="longtext"><a href="'+g(e)+'" target="_blank">'+g(e)+"<a></div>"+u(e)+"</div>"),m.open(f,n),$("#infoWindow").fadeIn(1e3),document.getElementById("photoLink").addEventListener("click",function(){function n(e){o+=e,0==o?$("#prev").hide():o==a-1?$("#next").hide():($("#prev").show(),$("#next").show()),$("#frame").children().fadeOut(400),$("#frame").children().eq(o).fadeIn(400),t()}function t(){$("#photoCounter").text(o+1+" / "+a)}$("#photoViewer").show(),$("#frame").children("#0").fadeIn(1e3);var a=e.photos.length,o=0;t(),$("#frame").children().eq(o+1)&&$("#next").show(),$("#next").click(function(){n(1)}),$("#prev").click(function(){n(-1)}),$("#close").click(function(){$("#photoViewer").hide()})}),v.placePhotos(e.photos),f.panTo(n.position))}),google.maps.event.addListener(m,"closeclick",function(){v.markers().forEach(function(e){e.setAnimation(null)})})}function l(e){return e.opening_hours?e.opening_hours.weekday_text[b.getDay()-1]:""}function c(e){var n="",t=v.rateImg(e);if(e.rating){n='<div><span style="color: #df6d15; padding-right: 3px;">'+e.rating+"</span>";for(var a in t)n+='<img class="rate-star" src="'+t[a].star+'" />';return n+'<a id="reviewlink" style="padding-left: 15px;" href="#"">reviews</a></div>'}return'<span style="font-style: italic;">no rating available</span>'}function p(e){return e.international_phone_number?e.international_phone_number:"<span>Location:"+e.geometry.location+"</span>"}function g(e){return e.website?e.website:""}function u(e){return e.photos&&e.photos.length>1?'<a id="photoLink" href="#"">photos<a>':'<div id="photoLink"></div>'}function d(e){var n=e.name.replace(/[\s,]/g,"%20"),t="https://en.wikipedia.org/w/api.php?format=json&action=query&prop=extracts&exintro=&explaintext=&titles="+n,a=setTimeout(function(){console.log("Wiki API failed to load.")},3e3);$.ajax({url:t,dataType:"jsonp",success:function(e){var n=document.getElementById("wiki");for(var t in e.query.pages)void 0==e.query.pages[t].extract||""==e.query.pages[t].extract||(n.innerHTML="<span>"+e.query.pages[t].extract.substring(0,60)+'...</span><a style="display: block;" href=http://en.wikipedia.org/?curid='+e.query.pages[t].pageid+' target="_blank">read more on wikipedia</a>');clearTimeout(a)}})}var f,m,h,y,v=this,w={lat:53.339821,lng:-6.2362889999999425},k=[],b=new Date;v.nearByPlaces=ko.observableArray([]),v.places=ko.observableArray([]),v.markers=ko.observableArray([]),v.radius=ko.observable(2e3),v.keyword=ko.observable(""),v.switchInfoBox=ko.observable(!0),v.listBoolean=ko.observable(!0),v.placePhotos=ko.observableArray([]),v.rateImg=function(e){for(var n=Math.round(2*e.rating)/2,t=[],a=0;a<parseInt(n);a++)t.push({star:"images/full-star.png"});n-parseInt(n)!=0&&t.push({star:"images/half-star.png"});for(var a=0;a<parseInt(5-n);a++)t.push({star:"images/empty-star.png"});return t},v.icons=ko.computed(function(){var e=new Set,n=[];for(var t in v.nearByPlaces())e.add(v.nearByPlaces()[t].icon);return e.forEach(function(e){n.push({icon:e})}),n}),v.displayedPlaces=function(){var e=[],n=v.keyword().toLowerCase(),t=[];if(t=v.places().length<2?v.nearByPlaces():v.places(),""!=v.keyword())for(var a in t)(-1!=t[a].name.toLowerCase().indexOf(n)||-1!=t[a].types[0].toLowerCase().indexOf(n))&&e.push(t[a]);else e=t;return e},v.formattedType=function(e){var n=e.types[0].replace(/[_-]/g," ");return n.charAt(0).toUpperCase()+n.substr(1,n.length)};var x=[];e(),n(),i(),v.clickMarker=function(e){var n=e.name.toLowerCase();v.markers().forEach(function(e){e.title.toLowerCase()===n&&(google.maps.event.trigger(e,"click"),f.panTo(e.position))})},$("#filters").on("click","button",function(){var e=$(this).children("img").attr("src").split("/"),n=e[e.length-1].split("-")[0];k=[],"fitness"==n&&k.push("gym");for(var t in googlePlaceTypes)-1!=googlePlaceTypes[t].toLowerCase().indexOf(n.substring(0,4))&&k.push(googlePlaceTypes[t]);a(f.getCenter())}),$("#reset").on("click",function(){k=[],a(f.getCenter())})}ko.applyBindings(new e),$("[group~=controls]").show(1e3),$("#hide").click(function(){var e="",n=$(this).children("span").attr("class");e="left"===n.slice(29)?n.replace("left","right"):n.replace("right","left"),$(this).siblings("div").animate({width:"toggle"},500),$(this).children("span").attr("class",e)})});