Number.prototype.mod=function(e){return(this%e+e)%e},$(function(){function e(){function e(){var e={center:k,zoom:14,minZoom:3,maxZoom:18,disableDefaultUI:!0};m=new google.maps.Map(document.getElementById("map-canvas"),e),v=new google.maps.InfoWindow({pixelOffset:new google.maps.Size(-23,-10)}),x=google.maps.Animation.DROP,w=new google.maps.StyledMapType(styles,{name:"Styled Map"}),m.mapTypes.set("map_style",w),m.setMapTypeId("map_style")}function n(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){k={lat:e.coords.latitude,lng:e.coords.longitude},m.setCenter(k),i(k)},function(){t(!0,v,m.getCenter())}):(t(!1,v,m.getCenter()),i(k))}function t(e,n,t){i(k)}function i(e){y.nearByPlaces([]);var n=new google.maps.places.PlacesService(m);n.nearbySearch({location:e,radius:y.radius(),types:b},o)}function o(e,n,t){var i=new google.maps.LatLngBounds,o=function(){for(var n,t=0;n=e[t];t++)"political"!=n.types[n.types.length-1]&&(y.nearByPlaces.push(n),i.extend(n.geometry.location))};n===google.maps.places.PlacesServiceStatus.OK&&(o(),m.fitBounds(i),b=[])}function a(){function e(){var e=t.getPlaces();if(y.places(e),0!==y.places().length){if(1==y.places().length)i(y.places()[0].geometry.location),y.nearByPlaces().push(e[0]);else{var n=new google.maps.LatLngBounds;y.places().forEach(function(e){n.extend(e.geometry.location),m.fitBounds(n)})}document.getElementById("search-input").value="",y.keyword(""),x=google.maps.Animation.DROP}}y.places([]);var n=document.getElementById("search-input"),t=new google.maps.places.SearchBox(n);m.addListener("bounds_changed",function(){t.setBounds(m.getBounds()),k=m.getCenter()}),t.addListener("places_changed",e),b=[]}function r(e){var n=Math.sqrt($(window).width())+20;y.markers().forEach(function(e){e.setMap(null)}),y.markers([]),e.forEach(function(e){var t={url:e.icon,size:new google.maps.Size(n,n),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(n/4,n/2),scaledSize:new google.maps.Size(n/2.8,n/2.8)},i=new google.maps.Marker({map:m,icon:t,title:e.name,animation:x,position:e.geometry.location}),o=window.innerWidth,a=window.innerHeight,r=150,l=-a/5;800>o&&(r=-20,l=-1*(a/2-100)),i.addListener("click",function(){y.markers().forEach(function(e){e.setAnimation(null)}),null!==i.getAnimation()?i.setAnimation(null):(i.setAnimation(google.maps.Animation.BOUNCE),m.panTo(i.position),m.panBy(r,l))}),y.markers().push(i),google.maps.event.addListener(i,"click",function(){s(e,i)})})}function s(e,n){var t=new google.maps.places.PlacesService(m),i=200;$(window).width()<800&&(i=170),t.getDetails({placeId:e.place_id},function(e,t){if(u(e),g(e),t===google.maps.places.PlacesServiceStatus.OK){v.setContent('<div id="infoWindow" style="width:'+i+'px; font-size: 14px; display: none;"><p><h3>'+e.name+'</h3></p><hr><p><span style="font-size: 14px">'+e.formatted_address+'</span></p><p><span style="color: #4a7ea7; font-weight: bold;">'+l(e)+'</span></p><br><div id="wiki" style="white-space: normal;"><span></span></div><hr>'+c(e)+d(e)+"</div></p><p><span>"+p(e)+'</span></p><p><div class="longtext"><a href="'+y.getWeb(e)+'" target="_blank">'+y.getWeb(e)+'<a></div><hr style="background: #ffbccd;"><img style="width: 20px;" src="images/Foursquare-icon.png"><a href="#" id="fourLink" style="display: inline;"> Top 5 place by 4Square</a>'),v.open(m,n),$("#infoWindow").fadeIn(1e3),y.placePhotos(e.photos),document.getElementById("photoLink").addEventListener("click",function(){function n(e){o+=e,0===o?($("#prev").hide(),$("#next").show()):o===i-1?($("#next").hide(),$("#prev").show()):($("#prev").show(),$("#next").show()),$("#frame").children().eq(o-e).hide(),$("#frame").children().eq(o).show(),t()}function t(){$("#photoCounter").text(o+1+" / "+i)}$("#photoViewer").show();var i=e.photos.length,o=0;n(0),$("#next").click(function(){n(1)}),$("#prev").click(function(){n(-1)}),$("#close-photo").click(function(){$("#frame").children().hide(),$("#photoViewer").hide(),o=0})});var o=document.getElementById("reviewlink");o&&o.addEventListener("click",function(){y.placeReviews([]),y.placeInFocus(e);var n=[];e.reviews.forEach(function(e){""!==e.text&&n.push(e)}),y.placeReviews(n),$("#review-page").show(),$("#reviews").children().show(),$("#close-review").click(function(){$("#reviews").children().hide(),$("#review-page").hide()})});var a=document.getElementById("fourLink");a&&a.addEventListener("click",function(){y.foursquarePlaces(u(e)),$("#foursquare-page").show(),$("#close-foursquare").click(function(){$("#foursquare").children().hide(),$("#foursquare-page").hide()})})}}),google.maps.event.addListener(v,"closeclick",function(){y.markers().forEach(function(e){e.setAnimation(null)})})}function l(e){var n=e.opening_hours;return n?n.weekday_text[(P.getDay()-1).mod(7)]:""}function c(e){var n="",t=y.rateImg(e.rating);if(e.rating){n='<div><span style="color: #df6d15; padding-right: 3px;">'+e.rating+"</span>";for(var i in t)i&&(n+='<img class="rate-star" src="'+t[i].star+'" />');return n+'<a id="reviewlink" style="padding-left: 10px;" href="#"">reviews,</a>'}return'<span style="font-style: italic;">no rating available</span>'}function p(e){return e.international_phone_number?e.international_phone_number:"<span>Location:"+e.geometry.location+"</span>"}function d(e){return e.photos&&e.photos.length>1?'<a style="margin-left: 5px;" id="photoLink" href="#"">photos</a>':'<div id="photoLink"></div></div>'}function u(e){var n=e.geometry.location.lat(),t=e.geometry.location.lng(),i="https://api.foursquare.com/v2/venues/explore?ll=",o=n+", "+t,a="&limit=5&section=topPicks&day=any&time=any&locale=en&&client_id=PMDCA1TH4CXRVBSLMBTPME2OBYL4G2FY5JZJ1SHXPW5T50ZL&client_secret=ZYQZSU5EZP3T0PRYJASI0N5X12ORCCI5113ENQOQAKIR1AAP&v=20151119",r=i+o+a;$.getJSON(r,function(e){y.foursquarePlaces(e.response.groups[0].items)}).fail(function(){console.log("The foursquare API faild to load."),y.foursquarePlaces([{venue:{name:"FOURSQUARE API failed to load.",categories:[{name:""}],location:{formattedAddress:""}},tips:[{text:"Try reload the page!"}]}])}).always(function(){console.log("The foursquare request finished.")})}function g(e){var n=e.name.replace(/[\s,]/g,"%20"),t="https://en.wikipedia.org/w/api.php?format=json&action=query&prop=extracts&exintro=&explaintext=&titles="+n,i=setTimeout(function(){console.log("Wiki API failed to load.")},3e3);$.ajax({url:t,dataType:"jsonp",success:function(e){var n=document.getElementById("wiki");for(var t in e.query.pages)void 0===e.query.pages[t].extract||""===e.query.pages[t].extract||(n.innerHTML="<span>"+e.query.pages[t].extract.substring(0,60)+'...</span><a style="display: block;" href=http://en.wikipedia.org/?curid='+e.query.pages[t].pageid+' target="_blank">read more on wikipedia</a>');clearTimeout(i)}})}function f(e){var n=$(".infolist"),t=$(".infolist").scrollLeft(),i=parseInt(t/(L-26));i+=e,n.animate({scrollLeft:i*L-26*i},1e3)}function h(){$(window).width()<800&&($("#next-list").children().show(),$(".row").css("width",L),$(".col-md-8").css("width",L-2*($(".navigator").width()+26)))}var m,v,w,y=this,k={lat:42.3601,lng:-71.0589},b=[],x=null,P=new Date,L=$(window).width();y.nearByPlaces=ko.observableArray([]),y.places=ko.observableArray([]),y.markers=ko.observableArray([]),y.radius=ko.observable(2e3),y.keyword=ko.observable(""),y.placeReviews=ko.observableArray([]),y.placePhotos=ko.observableArray([]),y.placeInFocus=ko.observable(),y.foursquarePlaces=ko.observableArray([]),y.address=function(e){return e.vicinity?e.vicinity:e.formatted_address},y.icons=ko.computed(function(){var e=new Set,n=[];for(var t in y.nearByPlaces())t&&e.add(y.nearByPlaces()[t].icon);return e.forEach(function(e){n.push({icon:e})}),n.slice(0,8)}),y.rateImg=function(e){e=Math.round(2*e)/2;for(var n=[],t=0;t<parseInt(e);t++)n.push({star:"images/full-star.png"});for(e-parseInt(e)!==0&&n.push({star:"images/half-star.png"}),t=0;t<parseInt(5-e);t++)n.push({star:"images/empty-star.png"});return n},y.displayedPlaces=function(){var e=[],n=y.keyword().toLowerCase(),t=[],i=window.innerWidth;if(t=y.places().length<2?y.nearByPlaces():y.places(),""!==y.keyword())for(var o in t)(-1!=t[o].name.toLowerCase().indexOf(n)||-1!=t[o].types[0].toLowerCase().indexOf(n))&&(x=null,e.push(t[o]));else e=500>i?t.slice(0,12):t;return r(e),e},y.formattedType=function(e){var n=e.types[0].replace(/[_-]/g," ");return n.charAt(0).toUpperCase()+n.substr(1,n.length)},e(),n(),a(),y.getWeb=function(e){return e.website?e.website:""},y.clickMarker=function(e){var n=e.name.toLowerCase();y.markers().forEach(function(e){e.title.toLowerCase()===n&&google.maps.event.trigger(e,"click")})},$("#filters").on("click","button",function(){y.places([]),x=google.maps.Animation.DROP;var e=$(this).children("img").attr("src").split("/"),n=e[e.length-1].split("-")[0];b=[],"fitness"==n&&b.push("gym");for(var t in googlePlaceTypes)-1!=googlePlaceTypes[t].toLowerCase().indexOf(n.substring(0,4))&&b.push(googlePlaceTypes[t]);i(m.getCenter())}),$("#reset").on("click",function(){y.places([]),b=[],i(m.getCenter())}),$("#prev-list").children().hide(),$("#next-list").children().hide(),$("#prev-list").children().click(function(){var e=$(".infolist").scrollLeft()/(L-26);f(e===parseInt(e,10)?-1:0)}),$("#next-list").children().click(function(){var e=$(".infolist").scrollLeft()/(L-26);f(e===parseInt(e,10)?1:0)}),$(".infolist").scroll(function(){var e=$(this).children("li").length;$(this).scrollLeft()<L/3?$("#prev-list").children().hide():$(this).scrollLeft()>(e-2)*L?$("#next-list").children().hide():($("#prev-list").children().show(),$("#next-list").children().show())}),h(),$(window).resize(function(){h()});var I=0,B=$(".infolist");setInterval(function(){var e=B.children("li").length,n=B.scrollLeft()/(L-26);n>e-2||n!==parseInt(n,10)&&(I>n?f(0):n>I&&f(1),I=Math.round(n))},1200)}ko.applyBindings(new e),$(".infolist").css("height",.8*($(".infolist").parent().height()-60)),$(".infolist").each(function(){var e=$(window).height(),n=$(window).width();e>n&&$(this).css("height","60%")}),$("#hide").click(function(){var e="",n=$(this).children("span").attr("class");e="left"===n.slice(29)?n.replace("left","right"):n.replace("right","left"),$(this).siblings("div").animate({width:"toggle"},500),$(this).children("span").attr("class",e)})});